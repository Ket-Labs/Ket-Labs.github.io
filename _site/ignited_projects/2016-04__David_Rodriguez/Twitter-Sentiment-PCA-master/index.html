<!DOCTYPE html>
<html>


<link rel="shortcut icon" type="image/png" href="/images/favicon.png">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Sentiment and Principal Component Analysis of Twitter Data: Microsoft Study</title>
  <meta name="description" content="Get a data science upgrade for your team, research lab or personal project. 
">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://www.ket-labs.com/ignited_projects/2016-04__David_Rodriguez/Twitter-Sentiment-PCA-master/">
  <link rel="alternate" type="application/rss+xml" title="Ket Labs" href="http://www.ket-labs.com/feed.xml" />
<link rel='stylesheet' id='open-sans-css'  href='//fonts.googleapis.com/css?family=Open+Sans%3A300italic%2C400italic%2C600italic%2C300%2C400%2C600&#038;subset=latin%2Clatin-ext&#038;ver=4.2.4' type='text/css' media='all' />
<link href='http://fonts.googleapis.com/css?family=Titillium+Web:600italic,600,400,400italic' rel='stylesheet' type='text/css'>





<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-77268505-1', 'auto');
  ga('send', 'pageview');

</script>
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">Ket Labs</a>


    <nav class="site-nav">

      <a href="#" class="menu-icon menu.open">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>  

    <div class="trigger"><h1>Main Navigation</h1>

 <ul class="menu">

    
    
     <li><a href="/data_science/" class="page-link">Data Science</a>
    
    </li>
    
    
     <li><a href="/who_we_are/" class="page-link">Who we are</a>
    
    </li>
    
    
     <li><a href="/bootcamp/" class="page-link">Bootcamp</a>
    
    </li>
    
    
     <li><a href="/ignited_projects/" class="page-link">Ignited Projects</a>
    
    </li>
    
    
     <li><a href="/contact/" class="page-link">Contact</a>
    
    </li>
    
    </ul>


<!-- <ul class="menu">
        <li> <a class="page-link" href="/about">About</a></li>
        <li> <a class="page-link"  href="/blog">Blog</a>
        <li> <a class="page-link" href="/blog">CV</a>
        <li> <a class="page-link" href="/blog">For Students</a></li>
        <li> <a class="page-link"  href="/blog">Research</a></a>
        <li> <a class="page-link" href="/blog">Teaching</a>
<ul class="sub-menu">
	<li><a href="http://svmiller.com/teaching/posc-1020-introduction-to-international-relations/">POSC 1020 – Introduction to International Relations</a></li>
	<li><a href="http://svmiller.com/teaching/posc-3410-quantitative-methods-in-political-science/">POSC 3410 – Quantitative Methods in Political Science</a></li>
	<li><a href="http://svmiller.com/teaching/posc-3610-international-politics-in-crisis/">POSC 3610 – International Politics in Crisis</a></li>
	<li><a href="http://svmiller.com/teaching/posc-3630-united-states-foreign-policy/">POSC 3630 – United States Foreign Policy</a></li>
</ul></li>
        <li> <a class="page-link" href="/blog">Miscellany</a>
<ul class="sub-menu">
	<li><a href="http://svmiller.com/teaching/posc-1020-introduction-to-international-relations/">Clean USAID Greenbook Data</a></li>
	<li><a href="http://svmiller.com/teaching/posc-3410-quantitative-methods-in-political-science/">Journal of Peace Research *.bst File</a></li>
	<li><a href="http://svmiller.com/teaching/posc-3610-international-politics-in-crisis/">My Custom Beamer Style</a></li>
</ul> 

</li>
</ul> -->

     </div>  
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">Sentiment and Principal Component Analysis of Twitter Data: Microsoft Study</h1>
  </header>

  <article class="post-content">
    <p>﻿
David Rodriguez<br />
February 24, 2016</p>

<h2 id="introduction">Introduction</h2>

<p>Twitter is a powerful tool that enables users to communicate with others and also empowers data scientists with large quantities of data they can use. Communications on twitter are live and dynamic, changing every second. They are also short, limited to 140 characters. The analysis of such short, fast-moving data can reveal how people communicate on a particular subject.</p>

<p>For example, by mining Twitter search data one can explore trends of stock prices against sentiments or specific words. One can also explore what makes a popular tweet, an excersize that can lead to efficient social media marketing. One can also compare tweets for different search terms, such as for different companies, and identfy what makes people excited about them or what their more prominent complaints are.</p>

<p>For this analysis, I have chosen to gather recent English-language tweets containing the word ‘microsoft’. This allows me to explore how people regard the microsoft brand, as well as how they treat any news articles referring to microsoft. 
The end goal of my study was to attempt to <strong>predict how users would tweet about the specified subject</strong> based on user information publicly available for Twitter accounts.</p>

<h2 id="experiment-setup">Experiment Setup</h2>

<p>Load up required packages:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">twitteR</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">tm</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">rjson</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">wordcloud</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">caret</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">knitr</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">RColorBrewer</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">stringr</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">syuzhet</span><span class="p">)</span> <span class="c1"># for sentiment analysis
</span><span class="n">library</span><span class="p">(</span><span class="n">rattle</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">lubridate</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">rpart</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">randomForest</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">glmnet</span><span class="p">)</span>
</code></pre>
</div>

<p>To access twitter, I need to provide authorization credentials for my Twitter application:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">secrets</span> <span class="o">&lt;-</span> <span class="n">fromJSON</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s1">'twitter_secrets.json.nogit'</span><span class="p">)</span>

<span class="n">setup_twitter_oauth</span><span class="p">(</span><span class="n">secrets</span><span class="o">$</span><span class="n">api_key</span><span class="p">,</span>
                    <span class="n">secrets</span><span class="o">$</span><span class="n">api_secret</span><span class="p">,</span>
                    <span class="n">secrets</span><span class="o">$</span><span class="n">access_token</span><span class="p">,</span>
                    <span class="n">secrets</span><span class="o">$</span><span class="n">access_token_secret</span><span class="p">)</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## [1] "Using direct authentication"
</code></pre>
</div>

<p>Perform a twitter search and extract the information I want:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">searchstring</span> <span class="o">&lt;-</span> <span class="s1">'microsoft'</span>
<span class="n">numtweets</span> <span class="o">&lt;-</span> <span class="m">10000</span>
<span class="n">st</span> <span class="o">&lt;-</span> <span class="n">searchTwitter</span><span class="p">(</span><span class="n">searchstring</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">numtweets</span><span class="p">,</span> <span class="n">resultType</span> <span class="o">=</span> <span class="s1">'recent'</span><span class="p">,</span> <span class="n">lang</span> <span class="o">=</span> <span class="s1">'en'</span><span class="p">)</span>

<span class="n">statuses</span> <span class="o">&lt;-</span> <span class="n">data.frame</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">sapply</span><span class="p">(</span><span class="n">st</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">x</span><span class="o">$</span><span class="n">getText</span><span class="p">()),</span>
                       <span class="n">user</span><span class="o">=</span><span class="n">sapply</span><span class="p">(</span><span class="n">st</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">x</span><span class="o">$</span><span class="n">getScreenName</span><span class="p">()),</span>
                       <span class="n">RT</span><span class="o">=</span><span class="n">sapply</span><span class="p">(</span><span class="n">st</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">x</span><span class="o">$</span><span class="n">isRetweet</span><span class="p">),</span>
                       <span class="n">latitude</span><span class="o">=</span><span class="n">sapply</span><span class="p">(</span><span class="n">st</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">as.numeric</span><span class="p">(</span><span class="n">x</span><span class="o">$</span><span class="n">latitude</span><span class="p">[</span><span class="m">1</span><span class="p">])),</span>
                       <span class="n">longitude</span><span class="o">=</span><span class="n">sapply</span><span class="p">(</span><span class="n">st</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">as.numeric</span><span class="p">(</span><span class="n">x</span><span class="o">$</span><span class="n">longitude</span><span class="p">[</span><span class="m">1</span><span class="p">])),</span>
                       <span class="n">time</span><span class="o">=</span><span class="n">sapply</span><span class="p">(</span><span class="n">st</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="o">$</span><span class="n">created</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s1">'%F %T'</span><span class="p">))</span>
                       <span class="p">)</span>
</code></pre>
</div>

<p>Remove retweets for clarity:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">statuses</span> <span class="o">&lt;-</span>
    <span class="n">statuses</span> <span class="o">%&gt;%</span>
    <span class="n">filter</span><span class="p">(</span><span class="o">!</span><span class="n">RT</span><span class="p">)</span>
</code></pre>
</div>

<p>Save tweets for future use:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">today</span> <span class="o">&lt;-</span> <span class="n">format</span><span class="p">(</span><span class="n">Sys.time</span><span class="p">(),</span> <span class="s1">'%Y-%m-%d'</span><span class="p">)</span>
<span class="n">savename</span> <span class="o">&lt;-</span> <span class="n">paste0</span><span class="p">(</span><span class="s1">'data/tweets_'</span><span class="p">,</span><span class="n">searchstring</span><span class="p">,</span><span class="s1">'_'</span><span class="p">,</span>
                   <span class="n">nrow</span><span class="p">(</span><span class="n">statuses</span><span class="p">),</span><span class="s1">'_'</span><span class="p">,</span><span class="n">today</span><span class="p">,</span><span class="s1">'.Rda'</span><span class="p">)</span>
<span class="n">saveRDS</span><span class="p">(</span><span class="n">statuses</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">savename</span><span class="p">)</span>
</code></pre>
</div>

<p>Alternatively, I load up prior searches to avoid re-running:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">files</span> <span class="o">&lt;-</span> <span class="n">list.files</span><span class="p">(</span><span class="s1">'data'</span><span class="p">,</span><span class="s1">'tweets_'</span><span class="p">)</span>
<span class="n">searchstring</span> <span class="o">&lt;-</span> <span class="s1">'microsoft'</span>
<span class="n">rm</span><span class="p">(</span><span class="n">statuses</span><span class="p">)</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## Warning in rm(statuses): object 'statuses' not found
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="m">1</span><span class="o">:</span><span class="n">length</span><span class="p">(</span><span class="n">files</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">selectedfile</span> <span class="o">&lt;-</span> <span class="n">paste0</span><span class="p">(</span><span class="s1">'data/'</span><span class="p">,</span><span class="n">files</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">exists</span><span class="p">(</span><span class="s1">'statuses'</span><span class="p">)){</span>
        <span class="n">statuses</span> <span class="o">&lt;-</span> <span class="n">readRDS</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">selectedfile</span><span class="p">)</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="n">statuses</span> <span class="o">&lt;-</span> <span class="n">rbind</span><span class="p">(</span><span class="n">statuses</span><span class="p">,</span> <span class="n">readRDS</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">selectedfile</span><span class="p">))</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<p>Total number of tweets to process is 13132</p>

<h2 id="text-analysis">Text Analysis</h2>

<p>Gather the tweets:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">textdata</span> <span class="o">&lt;-</span> <span class="n">Corpus</span><span class="p">(</span><span class="n">VectorSource</span><span class="p">(</span><span class="n">statuses</span><span class="o">$</span><span class="n">text</span><span class="p">))</span>

<span class="n">textdata</span> <span class="o">&lt;-</span> 
    <span class="n">textdata</span> <span class="o">%&gt;%</span>
    <span class="n">tm_map</span><span class="p">(</span><span class="n">removeWords</span><span class="p">,</span> <span class="n">stopwords</span><span class="p">(</span><span class="s2">"english"</span><span class="p">),</span> <span class="n">mc.cores</span><span class="o">=</span><span class="m">1</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="n">tm_map</span><span class="p">(</span><span class="n">removePunctuation</span><span class="p">,</span> <span class="n">mc.cores</span><span class="o">=</span><span class="m">1</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="n">tm_map</span><span class="p">(</span><span class="n">content_transformer</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">iconv</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">to</span><span class="o">=</span><span class="s1">'UTF-8-MAC'</span><span class="p">,</span> <span class="n">sub</span><span class="o">=</span><span class="s1">'byte'</span><span class="p">)),</span>
           <span class="n">mc.cores</span><span class="o">=</span><span class="m">1</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="n">tm_map</span><span class="p">(</span><span class="n">content_transformer</span><span class="p">(</span><span class="n">tolower</span><span class="p">),</span> <span class="n">mc.cores</span><span class="o">=</span><span class="m">1</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="n">tm_map</span><span class="p">(</span><span class="n">content_transformer</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">str_replace_all</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">"@\\w+"</span><span class="p">,</span> <span class="s2">""</span><span class="p">)),</span> 
           <span class="n">mc.cores</span><span class="o">=</span><span class="m">1</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="c1"># remove twitter handles
</span>    <span class="n">tm_map</span><span class="p">(</span><span class="n">removeNumbers</span><span class="p">,</span> <span class="n">mc.cores</span><span class="o">=</span><span class="m">1</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="n">tm_map</span><span class="p">(</span><span class="n">stemDocument</span><span class="p">,</span> <span class="n">mc.cores</span><span class="o">=</span><span class="m">1</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="n">tm_map</span><span class="p">(</span><span class="n">stripWhitespace</span><span class="p">,</span> <span class="n">mc.cores</span><span class="o">=</span><span class="m">1</span><span class="p">)</span>

<span class="n">save</span><span class="p">(</span><span class="n">textdata</span><span class="p">,</span> <span class="n">file</span> <span class="o">=</span> <span class="s1">'data/testdata_corpus.RData'</span><span class="p">)</span> 
<span class="n">rm</span><span class="p">(</span><span class="n">textdata</span><span class="p">)</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">load</span><span class="p">(</span><span class="s1">'data/testdata_corpus.RData'</span><span class="p">)</span> 
</code></pre>
</div>

<p>A quick wordcloud of the tweets reveals the 100 most commonly used words:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">pal2</span> <span class="o">&lt;-</span> <span class="n">brewer.pal</span><span class="p">(</span><span class="m">8</span><span class="p">,</span><span class="s2">"RdBu"</span><span class="p">)</span>
<span class="n">wordcloud</span><span class="p">(</span><span class="n">textdata</span><span class="p">,</span> <span class="n">max.words</span> <span class="o">=</span> <span class="m">100</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span> <span class="n">pal2</span><span class="p">,</span> <span class="n">random.order</span><span class="o">=</span><span class="n">F</span><span class="p">,</span> 
          <span class="n">rot.per</span><span class="o">=</span><span class="m">0.1</span><span class="p">,</span> <span class="n">use.r.layout</span><span class="o">=</span><span class="n">F</span><span class="p">)</span>
</code></pre>
</div>

<p><img src="microsoft_analysis_files/figure-html/wordcloud-1.png" alt="" /></p>

<p>I perform a sentiment analysis on the text data by comparing the words with those from the <a href="http://saifmohammad.com/WebPages/NRC-Emotion-Lexicon.htm">NRC Word-Emotion Association Lexicon</a>, which assigns them to 8 emotions (eg, anger, joy, etc) and 2 sentiments (postive and negative). I create a new variable, positivity, which is the difference between the positive and negative sentiments.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">sentiments</span> <span class="o">&lt;-</span> <span class="n">sapply</span><span class="p">(</span><span class="n">textdata</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">get_nrc_sentiment</span><span class="p">(</span><span class="n">as.character</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>

<span class="n">sentiments</span> <span class="o">&lt;-</span> <span class="n">as.data.frame</span><span class="p">(</span><span class="n">aperm</span><span class="p">(</span><span class="n">sentiments</span><span class="p">))</span> <span class="c1"># transpose and save as dataframe
</span><span class="n">sentiments</span> <span class="o">&lt;-</span> <span class="n">as.data.frame</span><span class="p">(</span><span class="n">lapply</span><span class="p">(</span><span class="n">sentiments</span><span class="p">,</span> <span class="n">as.numeric</span><span class="p">))</span> <span class="c1"># a bit more to organize
</span><span class="n">sentiments</span> <span class="o">&lt;-</span>
    <span class="n">sentiments</span> <span class="o">%&gt;%</span>
    <span class="n">mutate</span><span class="p">(</span><span class="n">positivity</span> <span class="o">=</span> <span class="n">positive</span> <span class="o">-</span> <span class="n">negative</span><span class="p">)</span>
</code></pre>
</div>

<p>Here are the emotions expressed in these tweets:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">emotions</span> <span class="o">&lt;-</span> <span class="n">data.frame</span><span class="p">(</span><span class="s2">"count"</span><span class="o">=</span><span class="n">colSums</span><span class="p">(</span><span class="n">sentiments</span><span class="p">[,</span><span class="n">c</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">8</span><span class="p">)]))</span>
<span class="n">emotions</span> <span class="o">&lt;-</span> <span class="n">cbind</span><span class="p">(</span><span class="s2">"sentiment"</span> <span class="o">=</span> <span class="n">rownames</span><span class="p">(</span><span class="n">emotions</span><span class="p">),</span> <span class="n">emotions</span><span class="p">)</span>

<span class="n">ggplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">emotions</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">sentiment</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">count</span><span class="p">))</span> <span class="o">+</span>
    <span class="n">geom_bar</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="n">sentiment</span><span class="p">),</span> <span class="n">stat</span> <span class="o">=</span> <span class="s2">"identity"</span><span class="p">)</span> <span class="o">+</span>
    <span class="n">xlab</span><span class="p">(</span><span class="s2">"Sentiment"</span><span class="p">)</span> <span class="o">+</span> <span class="n">ylab</span><span class="p">(</span><span class="s2">"Total Count"</span><span class="p">)</span> <span class="o">+</span> 
    <span class="n">scale_fill_brewer</span><span class="p">(</span><span class="n">palette</span><span class="o">=</span><span class="s1">'RdBu'</span><span class="p">)</span> <span class="o">+</span> 
    <span class="n">theme_bw</span><span class="p">()</span> <span class="o">+</span> <span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="o">=</span><span class="s1">'none'</span><span class="p">)</span>
</code></pre>
</div>

<p><img src="microsoft_analysis_files/figure-html/sentiment_plot-1.png" alt="" /></p>

<p>Further processing to get word counts:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">dtm</span> <span class="o">&lt;-</span> <span class="n">DocumentTermMatrix</span><span class="p">(</span><span class="n">textdata</span><span class="p">)</span>
<span class="n">dtm</span> <span class="o">&lt;-</span> <span class="n">inspect</span><span class="p">(</span><span class="n">dtm</span><span class="p">)</span>

<span class="n">save</span><span class="p">(</span><span class="n">dtm</span><span class="p">,</span> <span class="n">file</span> <span class="o">=</span> <span class="s1">'data/DocumentTermMatrix.RData'</span><span class="p">)</span> 
<span class="n">rm</span><span class="p">(</span><span class="n">dtm</span><span class="p">)</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">load</span><span class="p">(</span><span class="s1">'data/DocumentTermMatrix.RData'</span><span class="p">)</span> 
</code></pre>
</div>

<p>Sort in descending order to find the most common terms:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">words</span> <span class="o">&lt;-</span> <span class="n">data.frame</span><span class="p">(</span><span class="n">term</span> <span class="o">=</span> <span class="n">colnames</span><span class="p">(</span><span class="n">dtm</span><span class="p">))</span>
<span class="n">words</span><span class="o">$</span><span class="n">count</span> <span class="o">&lt;-</span> <span class="n">colSums</span><span class="p">(</span><span class="n">dtm</span><span class="p">)</span>

<span class="n">words</span> <span class="o">&lt;-</span>
    <span class="n">words</span> <span class="o">%&gt;%</span>
    <span class="n">arrange</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="n">count</span><span class="p">))</span>
<span class="n">head</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>##        term count
## 1 microsoft 11856
## 2    window  2311
## 3      xbox  2255
## 4   hololen  1721
## 5      game  1599
## 6       new  1192
</code></pre>
</div>

<p>Convert tweets to data frame and select only the top 100 words to process:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">tweets</span> <span class="o">&lt;-</span> <span class="n">as.data.frame</span><span class="p">(</span><span class="n">dtm</span><span class="p">)</span>
<span class="n">ind</span> <span class="o">&lt;-</span> <span class="n">data.frame</span><span class="p">(</span><span class="s1">'id'</span><span class="o">=</span><span class="n">seq.int</span><span class="p">(</span><span class="n">nrow</span><span class="p">(</span><span class="n">tweets</span><span class="p">)))</span>
<span class="n">tweets</span> <span class="o">&lt;-</span> <span class="n">cbind</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">tweets</span><span class="p">)</span>

<span class="n">words_100</span> <span class="o">&lt;-</span> <span class="n">as.character</span><span class="p">(</span><span class="n">words</span><span class="p">[</span><span class="m">2</span><span class="o">:</span><span class="m">101</span><span class="p">,</span><span class="s1">'term'</span><span class="p">])</span>
<span class="n">tweets</span> <span class="o">&lt;-</span> <span class="n">tweets</span><span class="p">[,</span><span class="n">c</span><span class="p">(</span><span class="s1">'id'</span><span class="p">,</span><span class="n">words_100</span><span class="p">)]</span>

<span class="n">save</span><span class="p">(</span><span class="n">tweets</span><span class="p">,</span> <span class="n">file</span> <span class="o">=</span> <span class="s1">'data/tweets.RData'</span><span class="p">)</span> 
<span class="n">rm</span><span class="p">(</span><span class="n">tweets</span><span class="p">,</span> <span class="n">dtm</span><span class="p">)</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">rm</span><span class="p">(</span><span class="n">dtm</span><span class="p">,</span> <span class="n">textdata</span><span class="p">)</span>
<span class="n">load</span><span class="p">(</span><span class="s1">'data/tweets.RData'</span><span class="p">)</span> 
</code></pre>
</div>

<h2 id="principal-component-analysis">Principal Component Analysis</h2>

<p>I’ll now perform a principal component analysis on the tweet data set and join the first 5 components to the original status array. This will allow me to reduce the number of paramaters to consider. That is, rather than considering each word individually, I can consider the linear combination of all words with appropriate loading factors that effectively group them by phrases.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">trans</span> <span class="o">&lt;-</span> <span class="n">preProcess</span><span class="p">(</span><span class="n">tweets</span><span class="p">[,</span><span class="m">2</span><span class="o">:</span><span class="n">ncol</span><span class="p">(</span><span class="n">tweets</span><span class="p">)],</span> <span class="n">method</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="s2">"pca"</span><span class="p">),</span> <span class="n">thresh</span> <span class="o">=</span> <span class="m">0.95</span><span class="p">)</span>
<span class="n">pca</span> <span class="o">&lt;-</span> <span class="n">predict</span><span class="p">(</span><span class="n">trans</span><span class="p">,</span> <span class="n">tweets</span><span class="p">[,</span><span class="m">2</span><span class="o">:</span><span class="n">ncol</span><span class="p">(</span><span class="n">tweets</span><span class="p">)])</span>
<span class="n">statuses</span> <span class="o">&lt;-</span> <span class="n">cbind</span><span class="p">(</span><span class="n">statuses</span><span class="p">,</span> <span class="n">pca</span><span class="p">[,</span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">],</span> <span class="n">sentiments</span><span class="p">)</span>
</code></pre>
</div>

<p>Let’s examine the reprojected data:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">pal2</span> <span class="o">&lt;-</span> <span class="n">brewer.pal</span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="s2">"RdBu"</span><span class="p">)</span>
<span class="n">ggplot</span><span class="p">(</span><span class="n">statuses</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">PC1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">PC2</span><span class="p">))</span> <span class="o">+</span> 
    <span class="n">geom_point</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">positivity</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="m">4</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="m">0.7</span><span class="p">,</span> <span class="n">pch</span><span class="o">=</span><span class="m">21</span><span class="p">,</span> <span class="n">stroke</span><span class="o">=</span><span class="m">1.3</span><span class="p">)</span> <span class="o">+</span> 
    <span class="n">scale_fill_gradientn</span><span class="p">(</span><span class="n">colours</span> <span class="o">=</span> <span class="n">pal2</span><span class="p">,</span> <span class="n">limits</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="m">-5</span><span class="p">,</span><span class="m">5</span><span class="p">))</span> <span class="o">+</span> <span class="n">theme_bw</span><span class="p">()</span>
</code></pre>
</div>

<p><img src="microsoft_analysis_files/figure-html/pca1-2_plot-1.png" alt="" /></p>

<p>Sometimes the other principal components are more illustrative:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">pal2</span> <span class="o">&lt;-</span> <span class="n">brewer.pal</span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="s2">"RdBu"</span><span class="p">)</span>
<span class="n">ggplot</span><span class="p">(</span><span class="n">statuses</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">PC2</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">PC3</span><span class="p">))</span> <span class="o">+</span> 
    <span class="n">geom_point</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">positivity</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="m">4</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="m">0.7</span><span class="p">,</span> <span class="n">pch</span><span class="o">=</span><span class="m">21</span><span class="p">,</span> <span class="n">stroke</span><span class="o">=</span><span class="m">1.3</span><span class="p">)</span> <span class="o">+</span> 
    <span class="n">scale_fill_gradientn</span><span class="p">(</span><span class="n">colours</span> <span class="o">=</span> <span class="n">pal2</span><span class="p">,</span> <span class="n">limits</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="m">-5</span><span class="p">,</span><span class="m">5</span><span class="p">))</span> <span class="o">+</span> <span class="n">theme_bw</span><span class="p">()</span>
</code></pre>
</div>

<p><img src="microsoft_analysis_files/figure-html/pca2-3_plot-1.png" alt="" /></p>

<p>I remove outliers, which I define as the 2% highest and lowest PC values in terms of PC1 and PC2:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">cutlevel</span> <span class="o">&lt;-</span> <span class="m">2</span><span class="o">/</span><span class="m">100</span><span class="err">.</span>
<span class="n">cut1</span> <span class="o">&lt;-</span> <span class="n">quantile</span><span class="p">(</span><span class="n">statuses</span><span class="o">$</span><span class="n">PC1</span><span class="p">,</span> <span class="n">probs</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="n">cutlevel</span><span class="p">,</span><span class="m">1</span><span class="o">-</span><span class="n">cutlevel</span><span class="p">))</span>
<span class="n">cut2</span> <span class="o">&lt;-</span> <span class="n">quantile</span><span class="p">(</span><span class="n">statuses</span><span class="o">$</span><span class="n">PC2</span><span class="p">,</span> <span class="n">probs</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="n">cutlevel</span><span class="p">,</span><span class="m">1</span><span class="o">-</span><span class="n">cutlevel</span><span class="p">))</span>

<span class="n">statuses</span> <span class="o">&lt;-</span> 
    <span class="n">statuses</span> <span class="o">%&gt;%</span>
    <span class="n">filter</span><span class="p">(</span><span class="n">PC1</span><span class="o">&gt;</span><span class="n">cut1</span><span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">PC1</span><span class="o">&lt;</span><span class="n">cut1</span><span class="p">[</span><span class="m">2</span><span class="p">])</span> <span class="o">%&gt;%</span>
    <span class="n">filter</span><span class="p">(</span><span class="n">PC2</span><span class="o">&gt;</span><span class="n">cut2</span><span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">PC2</span><span class="o">&lt;</span><span class="n">cut2</span><span class="p">[</span><span class="m">2</span><span class="p">])</span>
</code></pre>
</div>

<p>The loading factors reveal how important each term is to the principal component axes. Here are the top few terms of the first two components:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">loadings</span> <span class="o">&lt;-</span> <span class="n">trans</span><span class="o">$</span><span class="n">rotation</span> 
<span class="n">load_sqr</span> <span class="o">&lt;-</span> <span class="n">loadings</span><span class="o">^</span><span class="m">2</span>

<span class="n">load_sqr</span> <span class="o">&lt;-</span> <span class="n">data.frame</span><span class="p">(</span><span class="n">load_sqr</span><span class="p">)</span>
<span class="n">temp</span> <span class="o">&lt;-</span> <span class="n">data.frame</span><span class="p">(</span><span class="s1">'term'</span><span class="o">=</span><span class="n">rownames</span><span class="p">(</span><span class="n">load_sqr</span><span class="p">))</span>
<span class="n">load_sqr</span> <span class="o">&lt;-</span> <span class="n">cbind</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="n">load_sqr</span><span class="p">)</span>
<span class="n">load_sqr</span> <span class="o">%&gt;%</span>
    <span class="n">select</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="n">PC1</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="n">arrange</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="n">PC1</span><span class="p">))</span> <span class="o">%&gt;%</span>
    <span class="n">head</span><span class="p">(</span><span class="m">10</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="n">kable</span><span class="p">(</span><span class="n">format</span><span class="o">=</span><span class="s1">'html'</span><span class="p">)</span>
</code></pre>
</div>

<table>
 <thead>
  <tr>
   <th style="text-align:left;"> term </th>
   <th style="text-align:right;"> PC1 </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> restor </td>
   <td style="text-align:right;"> 0.0983066 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> slam </td>
   <td style="text-align:right;"> 0.0977344 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> epic </td>
   <td style="text-align:right;"> 0.0971905 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> faith </td>
   <td style="text-align:right;"> 0.0969293 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> human </td>
   <td style="text-align:right;"> 0.0939914 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> ballmer </td>
   <td style="text-align:right;"> 0.0914452 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> steve </td>
   <td style="text-align:right;"> 0.0911956 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> dunk </td>
   <td style="text-align:right;"> 0.0891933 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> former </td>
   <td style="text-align:right;"> 0.0891634 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> ceo </td>
   <td style="text-align:right;"> 0.0869296 </td>
  </tr>
</tbody>
</table>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">load_sqr</span> <span class="o">%&gt;%</span>
    <span class="n">select</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="n">PC2</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="n">arrange</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="n">PC2</span><span class="p">))</span> <span class="o">%&gt;%</span>
    <span class="n">head</span><span class="p">(</span><span class="m">10</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="n">kable</span><span class="p">(</span><span class="n">format</span><span class="o">=</span><span class="s1">'html'</span><span class="p">)</span>
</code></pre>
</div>

<table>
 <thead>
  <tr>
   <th style="text-align:left;"> term </th>
   <th style="text-align:right;"> PC2 </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> fun </td>
   <td style="text-align:right;"> 0.1589405 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> csrrace </td>
   <td style="text-align:right;"> 0.1557036 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> have </td>
   <td style="text-align:right;"> 0.1487819 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> join </td>
   <td style="text-align:right;"> 0.1443763 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> play </td>
   <td style="text-align:right;"> 0.1277830 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> free </td>
   <td style="text-align:right;"> 0.1087408 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> window </td>
   <td style="text-align:right;"> 0.0359545 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> hololen </td>
   <td style="text-align:right;"> 0.0129898 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> develop </td>
   <td style="text-align:right;"> 0.0115247 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> preorder </td>
   <td style="text-align:right;"> 0.0098478 </td>
  </tr>
</tbody>
</table>

<p>I’ve created a function to sample tweets across the PC spectrum.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">set.seed</span><span class="p">(</span><span class="m">42</span><span class="p">)</span>
<span class="n">tweet_check</span> <span class="o">&lt;-</span> <span class="k">function</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">pc</span><span class="p">,</span> <span class="n">numbreaks</span><span class="o">=</span><span class="m">5</span><span class="p">){</span>
    <span class="n">cuts</span> <span class="o">&lt;-</span> <span class="n">cut</span><span class="p">(</span><span class="n">pc</span><span class="p">,</span> <span class="n">numbreaks</span><span class="p">)</span>
    <span class="c1">#cuts &lt;- cut(pc, breaks=quantile(pc, probs=seq(0,1,1/numbreaks)))
</span>    <span class="n">temp</span> <span class="o">&lt;-</span> <span class="n">data.frame</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span> <span class="n">pc</span><span class="o">=</span><span class="n">pc</span><span class="p">,</span> <span class="n">pc_val</span><span class="o">=</span><span class="n">cuts</span><span class="p">)</span>
    <span class="n">temp</span> <span class="o">&lt;-</span> <span class="n">temp</span> <span class="o">%&gt;%</span>
        <span class="n">group_by</span><span class="p">(</span><span class="n">pc_val</span><span class="p">)</span> <span class="o">%&gt;%</span>
        <span class="n">summarise</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">iconv</span><span class="p">(</span><span class="n">sample</span><span class="p">(</span><span class="n">text</span><span class="p">,</span><span class="m">1</span><span class="p">),</span> <span class="n">to</span><span class="o">=</span><span class="s1">'UTF-8-MAC'</span><span class="p">,</span> <span class="n">sub</span><span class="o">=</span><span class="s1">'byte'</span><span class="p">))</span> <span class="o">%&gt;%</span>
        <span class="n">filter</span><span class="p">(</span><span class="o">!</span><span class="n">is.na</span><span class="p">(</span><span class="n">pc_val</span><span class="p">))</span>
    <span class="k">return</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>
</div>

<p>After examining some of the results, I found an interesting trend for PC2:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">set.seed</span><span class="p">(</span><span class="m">42</span><span class="p">)</span>
<span class="n">tweet_check</span><span class="p">(</span><span class="n">statuses</span><span class="o">$</span><span class="n">text</span><span class="p">,</span> <span class="n">statuses</span><span class="o">$</span><span class="n">PC2</span><span class="p">,</span> <span class="m">10</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="n">kable</span><span class="p">(</span><span class="n">format</span><span class="o">=</span><span class="s1">'html'</span><span class="p">)</span>
</code></pre>
</div>

<table>
 <thead>
  <tr>
   <th style="text-align:left;"> pc_val </th>
   <th style="text-align:left;"> text </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> (-4.36,-3.67] </td>
   <td style="text-align:left;"> You won't need an Xbox to play the next generation of Microsoft games - CNET: Microsoft will bring its games… https://t.co/wcXr4cbSDm |Cnet </td>
  </tr>
  <tr>
   <td style="text-align:left;"> (-3.67,-2.99] </td>
   <td style="text-align:left;"> You won't need an Xbox to play Microsoft's next generation of games https://t.co/BjA8WogLe5 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> (-2.99,-2.3] </td>
   <td style="text-align:left;"> WORLD | You won't need an Xbox to play Microsoft's next generation of games | Read: https://t.co/iRMVb4pf52 via Yahoo!© News </td>
  </tr>
  <tr>
   <td style="text-align:left;"> (-2.3,-1.62] </td>
   <td style="text-align:left;"> @MoiMarkus Have you tried Office Lens? https://t.co/9Cydi5kP77 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> (-1.62,-0.933] </td>
   <td style="text-align:left;"> Telstra offers 200GB free Microsoft OneDrive storage https://t.co/DuGr5ig3mf </td>
  </tr>
  <tr>
   <td style="text-align:left;"> (-0.933,-0.248] </td>
   <td style="text-align:left;"> AppOfTheDay:&quot;Voice Record+&quot;, a #WindowsPhone #App NOW FREE! on #AppDeals &amp;gt;&amp;gt; https://t.co/TWV12YmN6I https://t.co/5C4cstEpaw </td>
  </tr>
  <tr>
   <td style="text-align:left;"> (-0.248,0.436] </td>
   <td style="text-align:left;"> Measuring and evaluating visual desirability; how to measure visual appeal of a design or website: https://t.co/5WzVykYjEH </td>
  </tr>
  <tr>
   <td style="text-align:left;"> (0.436,1.12] </td>
   <td style="text-align:left;"> Microsoft Beijing Accelerator 7th Batch Demo Day - BEIJING, March BEIJING, March 1, 2016 /PRNewswire/  .. https://t.co/pVugdeujWa #microsoft </td>
  </tr>
  <tr>
   <td style="text-align:left;"> (1.12,1.8] </td>
   <td style="text-align:left;"> Microsoft's Hololens is up for pre-order, here's hoping you can expense it https://t.co/00w3rl7R8R </td>
  </tr>
  <tr>
   <td style="text-align:left;"> (1.8,2.5] </td>
   <td style="text-align:left;"> @zippylab Microsoft announces HoloLens specs, preorder dates, and what's in the Developer Edition
https://t.co/3fTvtH44ko via neowin </td>
  </tr>
</tbody>
</table>

<p>I notice that low PC2 values tend to be about the Xbox and high PC2 values tend to be about the Hololens. This presents a possible avenue for the predictive analysis. If I can devise a model to predict the value of PC2 based on a Twitter user’s data, I’ll know which product they are more excited about.</p>

<h2 id="gather-user-data">Gather User Data</h2>

<p>To carry out my models, I’ll need a lot more information. I gather all the user data for each particular tweet.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">userlist</span> <span class="o">&lt;-</span> <span class="n">sapply</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">statuses</span><span class="o">$</span><span class="n">user</span><span class="p">),</span> <span class="n">as.character</span><span class="p">)</span>
<span class="n">allusers</span> <span class="o">&lt;-</span> <span class="n">lookupUsers</span><span class="p">(</span><span class="n">userlist</span><span class="p">)</span>

<span class="c1"># Gather all the user info in a data frame
</span><span class="n">userinfo</span> <span class="o">&lt;-</span> <span class="n">data.frame</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">sapply</span><span class="p">(</span><span class="n">allusers</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">x</span><span class="o">$</span><span class="n">screenName</span><span class="p">),</span>
                       <span class="n">realname</span><span class="o">=</span><span class="n">sapply</span><span class="p">(</span><span class="n">allusers</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">x</span><span class="o">$</span><span class="n">name</span><span class="p">),</span>
                       <span class="n">numstatuses</span><span class="o">=</span><span class="n">sapply</span><span class="p">(</span><span class="n">allusers</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">x</span><span class="o">$</span><span class="n">statusesCount</span><span class="p">),</span>
                       <span class="n">followers</span><span class="o">=</span><span class="n">sapply</span><span class="p">(</span><span class="n">allusers</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">x</span><span class="o">$</span><span class="n">followersCount</span><span class="p">),</span>
                       <span class="n">friends</span><span class="o">=</span><span class="n">sapply</span><span class="p">(</span><span class="n">allusers</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">x</span><span class="o">$</span><span class="n">friendsCount</span><span class="p">),</span>
                       <span class="n">favorites</span><span class="o">=</span><span class="n">sapply</span><span class="p">(</span><span class="n">allusers</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">x</span><span class="o">$</span><span class="n">favoritesCount</span><span class="p">),</span>
                       <span class="n">account_created</span><span class="o">=</span><span class="n">sapply</span><span class="p">(</span><span class="n">allusers</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="o">$</span><span class="n">created</span><span class="p">,</span> 
                                                              <span class="n">format</span><span class="o">=</span><span class="s1">'%F %T'</span><span class="p">)),</span>
                       <span class="n">verified</span><span class="o">=</span><span class="n">sapply</span><span class="p">(</span><span class="n">allusers</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">x</span><span class="o">$</span><span class="n">verified</span><span class="p">),</span>
                       <span class="n">numlists</span><span class="o">=</span><span class="n">sapply</span><span class="p">(</span><span class="n">allusers</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">x</span><span class="o">$</span><span class="n">listedCount</span><span class="p">))</span> <span class="o">%&gt;%</span>
    <span class="n">mutate</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">as.character</span><span class="p">(</span><span class="n">user</span><span class="p">))</span> <span class="o">%&gt;%</span>
    <span class="n">mutate</span><span class="p">(</span><span class="n">twitter_years</span><span class="o">=</span><span class="n">interval</span><span class="p">(</span><span class="n">account_created</span><span class="p">,</span> <span class="n">Sys.time</span><span class="p">())</span> <span class="o">/</span> <span class="n">dyears</span><span class="p">(</span><span class="m">1</span><span class="p">))</span> <span class="o">%&gt;%</span>
    <span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="n">account_created</span><span class="p">)</span>

<span class="n">save</span><span class="p">(</span><span class="n">userinfo</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="s1">'data/userinfo.Rdata'</span><span class="p">)</span>
<span class="c1">#rm(userinfo)
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">load</span><span class="p">(</span><span class="s1">'data/userinfo.Rdata'</span><span class="p">)</span>
</code></pre>
</div>

<p>The original tweets will now be grouped together by user (taking averages of the relevant quantities of interest) and then joined together to the user information data frame:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">newstatuses</span> <span class="o">&lt;-</span>
    <span class="n">statuses</span> <span class="o">%&gt;%</span>
    <span class="n">group_by</span><span class="p">(</span><span class="n">user</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="n">summarize</span><span class="p">(</span><span class="n">numTopicTweets</span><span class="o">=</span><span class="n">n</span><span class="p">(),</span>
              <span class="n">positivity</span><span class="o">=</span><span class="n">mean</span><span class="p">(</span><span class="n">positivity</span><span class="p">),</span>
              <span class="n">PC1</span><span class="o">=</span><span class="n">mean</span><span class="p">(</span><span class="n">PC1</span><span class="p">),</span>
              <span class="n">PC2</span><span class="o">=</span><span class="n">mean</span><span class="p">(</span><span class="n">PC2</span><span class="p">),</span>
              <span class="n">PC3</span><span class="o">=</span><span class="n">mean</span><span class="p">(</span><span class="n">PC3</span><span class="p">),</span>
              <span class="n">PC4</span><span class="o">=</span><span class="n">mean</span><span class="p">(</span><span class="n">PC4</span><span class="p">),</span>
              <span class="n">PC5</span><span class="o">=</span><span class="n">mean</span><span class="p">(</span><span class="n">PC5</span><span class="p">),</span>
              <span class="n">client</span><span class="o">=</span><span class="n">rownames</span><span class="p">(</span><span class="n">sort</span><span class="p">(</span><span class="n">table</span><span class="p">(</span><span class="n">client</span><span class="p">),</span> <span class="n">decreasing</span> <span class="o">=</span> <span class="n">T</span><span class="p">))[</span><span class="m">1</span><span class="p">],</span>
              <span class="n">anger</span><span class="o">=</span><span class="n">mean</span><span class="p">(</span><span class="n">anger</span><span class="p">),</span> <span class="n">anticipation</span><span class="o">=</span><span class="n">mean</span><span class="p">(</span><span class="n">anticipation</span><span class="p">),</span> 
              <span class="n">disgust</span><span class="o">=</span><span class="n">mean</span><span class="p">(</span><span class="n">disgust</span><span class="p">),</span> <span class="n">fear</span><span class="o">=</span><span class="n">mean</span><span class="p">(</span><span class="n">fear</span><span class="p">),</span> <span class="n">joy</span><span class="o">=</span><span class="n">mean</span><span class="p">(</span><span class="n">joy</span><span class="p">),</span>
              <span class="n">sadness</span><span class="o">=</span><span class="n">mean</span><span class="p">(</span><span class="n">sadness</span><span class="p">),</span> <span class="n">surprise</span><span class="o">=</span><span class="n">mean</span><span class="p">(</span><span class="n">surprise</span><span class="p">),</span> <span class="n">trust</span><span class="o">=</span><span class="n">mean</span><span class="p">(</span><span class="n">trust</span><span class="p">))</span> <span class="o">%&gt;%</span> 
    <span class="n">mutate</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">as.character</span><span class="p">(</span><span class="n">user</span><span class="p">))</span>

<span class="c1"># Join the data together
</span><span class="n">alldata</span> <span class="o">&lt;-</span> <span class="n">inner_join</span><span class="p">(</span><span class="n">userinfo</span><span class="p">,</span> <span class="n">newstatuses</span><span class="p">,</span> <span class="n">by</span><span class="o">=</span><span class="s1">'user'</span><span class="p">)</span>
</code></pre>
</div>

<h2 id="predictive-analysis">Predictive Analysis</h2>

<h3 id="setup">Setup</h3>

<p>As described above, high and low values for the 2nd principal component appear to be related to a user’s tweeting about the Xbox or Hololens. As such, I’ll select it for my predictive analysis. This can readily be changed to another principal component, or the results of the sentiment analysis, for other studies.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">possiblepreds</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="p">(</span><span class="s1">'PC1'</span><span class="p">,</span><span class="s1">'PC2'</span><span class="p">,</span><span class="s1">'PC3'</span><span class="p">,</span><span class="s1">'PC4'</span><span class="p">,</span><span class="s1">'PC5'</span><span class="p">)</span>
<span class="n">choice</span> <span class="o">&lt;-</span> <span class="s1">'PC2'</span>

<span class="c1"># Remove columns
</span><span class="k">if</span><span class="p">(</span><span class="n">T</span><span class="p">){</span>
    <span class="n">colremove</span> <span class="o">&lt;-</span> <span class="n">possiblepreds</span><span class="p">[</span><span class="n">sapply</span><span class="p">(</span><span class="n">possiblepreds</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">x</span><span class="o">!=</span><span class="n">choice</span><span class="p">)]</span>
    <span class="n">col_list</span> <span class="o">&lt;-</span> <span class="n">colnames</span><span class="p">(</span><span class="n">alldata</span><span class="p">)</span>
    <span class="n">final_cols</span> <span class="o">&lt;-</span> <span class="n">col_list</span><span class="p">[</span><span class="n">sapply</span><span class="p">(</span><span class="n">col_list</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">!</span><span class="p">(</span><span class="n">x</span> <span class="o">%</span><span class="k">in</span><span class="o">%</span> <span class="n">colremove</span><span class="p">))]</span>
    <span class="n">df</span> <span class="o">&lt;-</span> <span class="n">alldata</span><span class="p">[</span><span class="n">final_cols</span><span class="p">]</span>
<span class="p">}</span><span class="k">else</span><span class="p">{</span>
    <span class="n">df</span> <span class="o">&lt;-</span> <span class="n">alldata</span>
<span class="p">}</span>

<span class="n">df</span> <span class="o">&lt;-</span> <span class="n">df</span> <span class="o">%&gt;%</span> 
    <span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="n">user</span><span class="p">,</span> <span class="o">-</span><span class="n">realname</span><span class="p">,</span> <span class="o">-</span><span class="n">client</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">anger</span><span class="o">:</span><span class="n">trust</span><span class="p">))</span> <span class="c1"># removing sentiment columns
</span></code></pre>
</div>

<p>In the event that there are parameters with little variance, I remove them:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">nzv</span> <span class="o">&lt;-</span> <span class="n">nearZeroVar</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">df_filter</span> <span class="o">&lt;-</span> <span class="n">df</span><span class="p">[,</span> <span class="o">-</span><span class="n">nzv</span><span class="p">]</span>
<span class="n">df_filter</span> <span class="o">&lt;-</span> <span class="n">na.omit</span><span class="p">(</span><span class="n">df_filter</span><span class="p">)</span>
</code></pre>
</div>

<p>There are now only 9 parameters, including PC2, for our 7944 users.</p>

<p>I’ll now prepare my training and test data sets:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">set.seed</span><span class="p">(</span><span class="m">3456</span><span class="p">)</span>
<span class="n">trainIndex</span> <span class="o">&lt;-</span> <span class="n">sample</span><span class="p">(</span><span class="n">nrow</span><span class="p">(</span><span class="n">df_filter</span><span class="p">),</span> <span class="n">nrow</span><span class="p">(</span><span class="n">df_filter</span><span class="p">)</span><span class="o">*</span><span class="m">0.8</span><span class="p">)</span>

<span class="n">df_train</span> <span class="o">&lt;-</span> <span class="n">df_filter</span><span class="p">[</span> <span class="n">trainIndex</span><span class="p">,]</span>
<span class="n">df_test</span>  <span class="o">&lt;-</span> <span class="n">df_filter</span><span class="p">[</span><span class="o">-</span><span class="n">trainIndex</span><span class="p">,]</span>
</code></pre>
</div>

<h3 id="regression-tree">Regression Tree</h3>

<p>First, I’ll run a regression tree model:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">rtGrid</span> <span class="o">&lt;-</span> <span class="n">expand.grid</span><span class="p">(</span><span class="n">cp</span><span class="o">=</span><span class="n">seq</span><span class="p">(</span><span class="m">0.005</span><span class="p">,</span> <span class="m">0.1</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="m">0.005</span><span class="p">))</span> <span class="c1"># grid of cp values
</span><span class="n">ctrl</span> <span class="o">&lt;-</span> <span class="n">trainControl</span><span class="p">(</span><span class="n">method</span> <span class="o">=</span> <span class="s2">"cv"</span><span class="p">,</span> <span class="n">number</span> <span class="o">=</span> <span class="m">10</span><span class="p">,</span> <span class="n">verboseIter</span> <span class="o">=</span> <span class="n">F</span><span class="p">)</span>

<span class="n">toRun</span> <span class="o">&lt;-</span> <span class="n">formula</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="n">choice</span><span class="p">,</span><span class="s1">' ~ .'</span><span class="p">))</span>
<span class="n">rtTune</span> <span class="o">&lt;-</span> <span class="n">train</span><span class="p">(</span><span class="n">toRun</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="s2">"rpart"</span><span class="p">,</span> 
                <span class="n">tuneGrid</span> <span class="o">=</span> <span class="n">rtGrid</span><span class="p">,</span> <span class="n">trControl</span> <span class="o">=</span> <span class="n">ctrl</span><span class="p">)</span>
<span class="n">final_tree</span> <span class="o">&lt;-</span> <span class="n">rtTune</span><span class="o">$</span><span class="n">finalModel</span>
</code></pre>
</div>

<p>The numeric values of our best fit are saved for later comparison:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">df_test_all</span> <span class="o">&lt;-</span> <span class="n">df_test</span>
<span class="n">df_test_all</span><span class="p">[,</span><span class="s1">'id'</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="n">seq</span><span class="p">(</span><span class="n">nrow</span><span class="p">(</span><span class="n">df_test_all</span><span class="p">))</span>
<span class="n">pr_rt</span> <span class="o">&lt;-</span> <span class="n">predict</span><span class="p">(</span><span class="n">rtTune</span><span class="p">,</span> <span class="n">newdata</span> <span class="o">=</span> <span class="n">df_test</span><span class="p">)</span>
<span class="n">rmseTree</span> <span class="o">&lt;-</span> <span class="n">RMSE</span><span class="p">(</span><span class="n">pr_rt</span><span class="p">,</span> <span class="n">df_test</span><span class="p">[,</span><span class="n">choice</span><span class="p">])</span>
<span class="n">modelSummary</span> <span class="o">&lt;-</span> <span class="n">data.frame</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s1">'Regression Tree'</span><span class="p">,</span>
                         <span class="n">RMSE</span><span class="o">=</span><span class="n">rmseTree</span><span class="p">)</span>

<span class="n">df_test_all</span><span class="p">[,</span><span class="s1">'diff_Tree'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_test_all</span><span class="p">[,</span><span class="n">choice</span><span class="p">]</span> <span class="o">-</span> <span class="n">pr_rt</span>
</code></pre>
</div>

<h3 id="generalized-linear-model">Generalized Linear Model</h3>

<p>I next run a generalized linear model:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">toRun</span> <span class="o">&lt;-</span> <span class="n">formula</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="n">choice</span><span class="p">,</span><span class="s1">' ~ .'</span><span class="p">))</span>
<span class="n">rtTune2</span> <span class="o">&lt;-</span> <span class="n">train</span><span class="p">(</span><span class="n">toRun</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="s2">"glm"</span><span class="p">)</span>

<span class="n">summary</span><span class="p">(</span><span class="n">rtTune2</span><span class="p">)</span>
</code></pre>
</div>

<p>The summary suggests the most significant quantities to predict the values of PC2 are the number of statuses (ie, tweets) and the positivity value.</p>

<p>As before, we save the results for future comparison:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">pr_rt</span> <span class="o">&lt;-</span> <span class="n">predict</span><span class="p">(</span><span class="n">rtTune2</span><span class="p">,</span> <span class="n">newdata</span> <span class="o">=</span> <span class="n">df_test</span><span class="p">)</span>
<span class="n">rmseGLM</span> <span class="o">&lt;-</span> <span class="n">RMSE</span><span class="p">(</span><span class="n">pr_rt</span><span class="p">,</span> <span class="n">df_test</span><span class="p">[,</span><span class="n">choice</span><span class="p">])</span>
    
<span class="n">newRow</span> <span class="o">&lt;-</span> <span class="n">data.frame</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s1">'Generalized LM'</span><span class="p">,</span>
                     <span class="n">RMSE</span><span class="o">=</span><span class="n">rmseGLM</span><span class="p">)</span>
<span class="n">modelSummary</span> <span class="o">&lt;-</span> <span class="n">rbind</span><span class="p">(</span><span class="n">modelSummary</span><span class="p">,</span> <span class="n">newRow</span><span class="p">)</span>
    
<span class="n">df_test_all</span><span class="p">[,</span><span class="s1">'diff_GLM'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_test_all</span><span class="p">[,</span><span class="n">choice</span><span class="p">]</span> <span class="o">-</span> <span class="n">pr_rt</span>
</code></pre>
</div>

<h3 id="random-forest">Random Forest</h3>

<p>Next, I run a random forest model:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">rtGrid</span> <span class="o">=</span> <span class="n">expand.grid</span><span class="p">(</span><span class="n">mtry</span><span class="o">=</span><span class="n">seq</span><span class="p">(</span><span class="m">3</span><span class="p">,</span> <span class="m">7</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="m">1</span><span class="p">))</span> <span class="c1"># grid of mtry values
</span><span class="n">ctrl</span> <span class="o">&lt;-</span> <span class="n">trainControl</span><span class="p">(</span><span class="n">method</span> <span class="o">=</span> <span class="s2">"cv"</span><span class="p">,</span> <span class="n">number</span> <span class="o">=</span> <span class="m">5</span><span class="p">,</span> <span class="n">verboseIter</span> <span class="o">=</span> <span class="n">F</span><span class="p">)</span>

<span class="n">toRun</span> <span class="o">&lt;-</span> <span class="n">formula</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="n">choice</span><span class="p">,</span><span class="s1">' ~ .'</span><span class="p">))</span>
<span class="n">rtTune3</span> <span class="o">&lt;-</span> <span class="n">train</span><span class="p">(</span><span class="n">toRun</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">,</span> 
                <span class="n">method</span> <span class="o">=</span> <span class="s2">"rf"</span><span class="p">,</span>
                <span class="n">tuneGrid</span> <span class="o">=</span> <span class="n">rtGrid</span><span class="p">,</span>
                <span class="n">trControl</span> <span class="o">=</span> <span class="n">ctrl</span><span class="p">,</span> <span class="n">importance</span><span class="o">=</span><span class="n">T</span><span class="p">)</span>
</code></pre>
</div>

<p>The best random forest model considers 3 random parameters at each split. This is the overall importance of the various parameters:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">varImp</span><span class="p">(</span><span class="n">rtTune3</span><span class="p">)</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## rf variable importance
## 
##                Overall
## positivity      100.00
## numlists         61.42
## followers        48.05
## numstatuses      41.74
## favorites        32.22
## twitter_years    22.83
## friends          22.06
## numTopicTweets    0.00
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">pr_rt</span> <span class="o">&lt;-</span> <span class="n">predict</span><span class="p">(</span><span class="n">rtTune3</span><span class="p">,</span> <span class="n">newdata</span> <span class="o">=</span> <span class="n">df_test</span><span class="p">)</span>
<span class="n">rmseRF</span> <span class="o">&lt;-</span> <span class="n">RMSE</span><span class="p">(</span><span class="n">pr_rt</span><span class="p">,</span> <span class="n">df_test</span><span class="p">[,</span><span class="n">choice</span><span class="p">])</span>
    
<span class="n">newRow</span> <span class="o">&lt;-</span> <span class="n">data.frame</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s1">'Random Forest'</span><span class="p">,</span>
                     <span class="n">RMSE</span><span class="o">=</span><span class="n">rmseRF</span><span class="p">)</span>
<span class="n">modelSummary</span> <span class="o">&lt;-</span> <span class="n">rbind</span><span class="p">(</span><span class="n">modelSummary</span><span class="p">,</span> <span class="n">newRow</span><span class="p">)</span>
    
<span class="n">df_test_all</span><span class="p">[,</span><span class="s1">'diff_RF'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_test_all</span><span class="p">[,</span><span class="n">choice</span><span class="p">]</span> <span class="o">-</span> <span class="n">pr_rt</span>
</code></pre>
</div>

<h3 id="glmnet">GLMNET</h3>

<p>Finally, I consider another generalized linear model with an elastic-net penalty that controls whether we are considering a lasso or ridge regression:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">enetGrid</span> <span class="o">&lt;-</span> <span class="n">expand.grid</span><span class="p">(</span><span class="n">.alpha</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0.1</span><span class="p">,</span> <span class="m">0.5</span><span class="p">,</span> <span class="m">0.7</span><span class="p">,</span> <span class="m">1</span><span class="p">),</span> 
                        <span class="n">.lambda</span> <span class="o">=</span> <span class="n">seq</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="m">0.1</span><span class="p">))</span>

<span class="n">ctrl</span> <span class="o">&lt;-</span> <span class="n">trainControl</span><span class="p">(</span><span class="n">method</span> <span class="o">=</span> <span class="s2">"cv"</span><span class="p">,</span> <span class="n">number</span> <span class="o">=</span> <span class="m">10</span><span class="p">,</span> <span class="n">verboseIter</span> <span class="o">=</span> <span class="n">F</span><span class="p">)</span>

<span class="n">toRun</span> <span class="o">&lt;-</span> <span class="n">formula</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="n">choice</span><span class="p">,</span><span class="s1">' ~ .'</span><span class="p">))</span>
<span class="n">rtTune4</span> <span class="o">&lt;-</span> <span class="n">train</span><span class="p">(</span><span class="n">toRun</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">,</span>    
                  <span class="n">method</span> <span class="o">=</span> <span class="s2">"glmnet"</span><span class="p">,</span> 
                  <span class="n">tuneGrid</span> <span class="o">=</span> <span class="n">enetGrid</span><span class="p">,</span>
                  <span class="n">trControl</span> <span class="o">=</span> <span class="n">ctrl</span><span class="p">)</span>
</code></pre>
</div>

<p>The best alpha and lambda parameters for the GLMNET model are 0.1, 0.1</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">pr_rt</span> <span class="o">&lt;-</span> <span class="n">predict</span><span class="p">(</span><span class="n">rtTune4</span><span class="p">,</span> <span class="n">newdata</span> <span class="o">=</span> <span class="n">df_test</span><span class="p">)</span>
<span class="n">rmseGLMNET</span> <span class="o">&lt;-</span> <span class="n">RMSE</span><span class="p">(</span><span class="n">pr_rt</span><span class="p">,</span> <span class="n">df_test</span><span class="p">[,</span><span class="n">choice</span><span class="p">])</span>
    
<span class="n">newRow</span> <span class="o">&lt;-</span> <span class="n">data.frame</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s1">'GLMNET'</span><span class="p">,</span>
                     <span class="n">RMSE</span><span class="o">=</span><span class="n">rmseGLMNET</span><span class="p">)</span>
<span class="n">modelSummary</span> <span class="o">&lt;-</span> <span class="n">rbind</span><span class="p">(</span><span class="n">modelSummary</span><span class="p">,</span> <span class="n">newRow</span><span class="p">)</span>
    
<span class="n">df_test_all</span><span class="p">[,</span><span class="s1">'diff_GLMNET'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_test_all</span><span class="p">[,</span><span class="n">choice</span><span class="p">]</span> <span class="o">-</span> <span class="n">pr_rt</span>
</code></pre>
</div>

<h2 id="model-comparison">Model Comparison</h2>

<p>The figure below compares the result of the various models:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">cols</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="p">(</span><span class="s2">"RTree"</span><span class="o">=</span><span class="s2">"dark green"</span><span class="p">,</span> <span class="s2">"GLM"</span><span class="o">=</span><span class="s2">"dark blue"</span><span class="p">,</span>
          <span class="s2">"RForest"</span><span class="o">=</span><span class="s2">"dark orange"</span><span class="p">,</span> <span class="s2">"GLMNET"</span><span class="o">=</span><span class="s2">"dark red"</span><span class="p">)</span>
<span class="n">alphalvl</span> <span class="o">&lt;-</span> <span class="m">0.3</span>
<span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df_test_all</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">id</span><span class="p">))</span> <span class="o">+</span>
    <span class="n">geom_point</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">diff_Tree</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'RTree'</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alphalvl</span><span class="p">)</span> <span class="o">+</span> 
    <span class="n">geom_hline</span><span class="p">(</span><span class="n">yintercept</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="n">rmseTree</span><span class="p">,</span> <span class="m">-1</span><span class="o">*</span><span class="n">rmseTree</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="n">cols</span><span class="p">[</span><span class="s1">'RTree'</span><span class="p">])</span> <span class="o">+</span>
    <span class="n">geom_point</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">diff_GLM</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'GLM'</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alphalvl</span><span class="p">)</span> <span class="o">+</span> 
    <span class="n">geom_hline</span><span class="p">(</span><span class="n">yintercept</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="n">rmseGLM</span><span class="p">,</span> <span class="m">-1</span><span class="o">*</span><span class="n">rmseGLM</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="n">cols</span><span class="p">[</span><span class="s1">'GLM'</span><span class="p">])</span> <span class="o">+</span>
    <span class="n">geom_point</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">diff_RF</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'RForest'</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alphalvl</span><span class="p">)</span> <span class="o">+</span> 
    <span class="n">geom_hline</span><span class="p">(</span><span class="n">yintercept</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="n">rmseRF</span><span class="p">,</span> <span class="m">-1</span><span class="o">*</span><span class="n">rmseRF</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="n">cols</span><span class="p">[</span><span class="s1">'RForest'</span><span class="p">])</span> <span class="o">+</span>
    <span class="n">geom_point</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">diff_GLMNET</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'GLMNET'</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alphalvl</span><span class="p">)</span> <span class="o">+</span> 
    <span class="n">geom_hline</span><span class="p">(</span><span class="n">yintercept</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="n">rmseGLMNET</span><span class="p">,</span> <span class="m">-1</span><span class="o">*</span><span class="n">rmseGLMNET</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="n">cols</span><span class="p">[</span><span class="s1">'GLMNET'</span><span class="p">])</span> <span class="o">+</span>
    <span class="n">theme_bw</span><span class="p">()</span> <span class="o">+</span> <span class="n">coord_cartesian</span><span class="p">(</span><span class="n">ylim</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="m">-2</span><span class="p">,</span><span class="m">2</span><span class="p">))</span> <span class="o">+</span> 
    <span class="n">scale_colour_manual</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"Model"</span><span class="p">,</span><span class="n">values</span><span class="o">=</span><span class="n">cols</span><span class="p">)</span> <span class="o">+</span>
    <span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">'Twitter User'</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">'Difference from Model'</span><span class="p">)</span>
</code></pre>
</div>

<p><img src="microsoft_analysis_files/figure-html/rmse_plot-1.png" alt="" /></p>

<p>Here is a table of the root mean square errors (RMSE), a measure of the goodness-of-fit:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">modelSummary</span> <span class="o">%&gt;%</span> <span class="n">kable</span><span class="p">(</span><span class="n">format</span><span class="o">=</span><span class="s1">'html'</span><span class="p">)</span>
</code></pre>
</div>

<table>
 <thead>
  <tr>
   <th style="text-align:left;"> model </th>
   <th style="text-align:right;"> RMSE </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Regression Tree </td>
   <td style="text-align:right;"> 0.7290474 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Generalized LM </td>
   <td style="text-align:right;"> 0.7281301 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Random Forest </td>
   <td style="text-align:right;"> 0.7065228 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> GLMNET </td>
   <td style="text-align:right;"> 0.7291258 </td>
  </tr>
</tbody>
</table>

<p>All models perform comparably similar with regards to the RMSE. As I discuss below, there may be a few ways to improve the models in order to yield more accurate results.</p>

<h2 id="summary">Summary</h2>

<p>I have looked at tweets concerning microsoft and have identified that the second principal component (PC2) appears to be relevant to sorting tweets by whether or not they are excited about the Hololens product or Xbox games on their personal computers. 
While in principle, there are a lot of tweets and variations, I chose to use PC2 as a measure of the phrases used and developed a set of models to attempt to predict what values of PC2 a user would have.</p>

<p>This approach can be useful to determine what types of users are excited about the Hololens and which are excited about Xbox games (in this example) and can suggest targetted advertizing.</p>

<p>Let’s have a look at the regression tree as it’s one of the clearest to describe:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">fancyRpartPlot</span><span class="p">(</span><span class="n">final_tree</span><span class="p">,</span> <span class="n">palettes</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="s2">"Blues"</span><span class="p">),</span> <span class="n">sub</span><span class="o">=</span><span class="s1">''</span><span class="p">)</span>
</code></pre>
</div>

<p><img src="microsoft_analysis_files/figure-html/rt_plot-1.png" alt="" /></p>

<p>The above suggests that users with very negative PC2 values (associated with excitement about the Xbox product) also have very few followers and have been on Twitter a very small amount of time. This suggest these types of users are actually Twitter robot accounts created to spam advertisement on this particular Xbox news story. I would argue it’s safe to disregard spending any advertising efforts on these users.</p>

<p>On the other hand, for higher PC2 values (associated with excitement about the Hololens product), we can see more meaningful information. The value of PC2 for a user depends on the postivity, which is a measure on how often positive and negative words are used; the number of statuses or tweets they’ve had; the number of lists they follow; and the number of Twitter favorites they have.</p>

<p>While these models can predict the values of PC2, their errors remain fairly large. I interpret this as the PC2 value having large variation in terms of the word choices used to construct the individual tweets.
A possible way to improve these models would be to consider more parameters given that we have enough data to support this. These additional parameters could come from twitter or from external sources.
Another possibility is to re-examine our source of data. Rather than gathering ‘recent’ tweets, we could have gathered ‘popuplar’ or ‘mixed’ tweets, which would rely on Twitter’s algorithms to return a different sample of tweets. 
Yet another possibility would be to consider a different API, such as gathering data from Facebook.</p>

<h2 id="conclusions">Conclusions</h2>

<p>In the end, while this project demonstrated a potential relationship between word choice and differentiation between Microsoft products, it can readily be expanded to any other topic of interest. However, given the varied nature of tweeted topics within a search, it is not always clear that a trend can or will emerge.</p>

<p>Alternative ways in which Twitter data could be used include:</p>

<ul>
  <li>Examining trends of stock market prices with respect to word choices or overall sentiment in Twitter</li>
  <li>Determining what properties of a tweet or user make for the most popular tweets in order to best market your product</li>
  <li>Comparing two search terms for two separate companies to identify and address any issues or complaints</li>
  <li>Exploring tweets by location to find popular venues or events</li>
</ul>

  </article>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

<!--     <h2 class="footer-heading">Ket Labs</h2> -->

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">
        <ul class="contact-list">
          <li><strong>Ket Labs</strong></li>

          <li><a href="mailto:ashehu@ket-labs.com">ashehu@ket-labs.com</a></li>
        </ul>
      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
          

          
        </ul>
      </div>

      <div class="footer-col  footer-col-3">
         <p class="text">
Get a data science upgrade for your team, research lab or personal project. 
 
      </div>
    </div>

  </div>

</footer>

  </body>

</html>
